(function(){"use strict";function w(o){const i=[];let e=[],s="",a=!1;for(let n=0;n<o.length;n+=1){const t=o[n],r=o[n+1];if(a){t==='"'?r==='"'?(s+='"',n+=1):a=!1:s+=t;continue}if(t==='"'){a=!0;continue}if(t===","){e.push(s),s="";continue}if(t===`
`){e.push(s),i.push(e),e=[],s="";continue}if(t==="\r"){r===`
`&&(n+=1),e.push(s),i.push(e),e=[],s="";continue}s+=t}return e.push(s),i.push(e),i.filter(n=>n.some(t=>t.trim().length))}function g(o){if(!o)return[];const i=o.length>0&&o.charCodeAt(0)===65279?o.slice(1):o,e=w(i);if(!e.length)return[];const[s,...a]=e,n=s.map(t=>t.trim());return a.map(t=>{const r={};return n.forEach((l,c)=>{r[l]=t[c]??""}),r})}function p(o){const e=String(o??"").normalize("NFKC").match(/(\d{4})/);return e?e[1]:""}let f=[];self.onmessage=async o=>{const{type:i,payload:e,id:s}=o.data;if(i==="init")try{const a=await fetch(e.path);if(!a.ok)throw new Error(`HTTP ${a.status}`);const n=await a.text();f=g(n);const t=Array.from(new Set(f.map(r=>p(r.導入月)).filter(r=>/^\d{4}$/.test(r)))).sort((r,l)=>Number(l)-Number(r));self.postMessage({type:"init-complete",years:t})}catch(a){self.postMessage({type:"error",error:a.message})}else if(i==="search"){if(!f.length){self.postMessage({type:"search-result",digits:null,recentHits:[],id:s});return}const{keyword:a,andCond:n}=e,t=(a??"").normalize("NFKC").toLowerCase(),r=[];for(const c of f){const C=Object.values(c),y=t?C.some(d=>d?.normalize("NFKC").toLowerCase().includes(t)):!0;let u=!0;const h=n?.field||"none",m=(n?.value??"").normalize("NFKC").toLowerCase();if(h==="name")u=(c.機種名??"").normalize("NFKC").toLowerCase().includes(m);else if(h==="maker")u=(c.メーカー??"").normalize("NFKC").toLowerCase().includes(m);else if(h==="year"){const d=p(c.導入月);u=!!m&&d===m}y&&u&&r.push({name:c.機種名,maker:c.メーカー})}const l=String(r.length).padStart(4,"0").split("");self.postMessage({type:"search-result",digits:l,recentHits:r,id:s})}}})();
