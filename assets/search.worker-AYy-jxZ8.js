(function(){"use strict";function g(o){const i=[];let e=[],n="",a=!1;for(let s=0;s<o.length;s+=1){const t=o[s],r=o[s+1];if(a){t==='"'?r==='"'?(n+='"',s+=1):a=!1:n+=t;continue}if(t==='"'){a=!0;continue}if(t===","){e.push(n),n="";continue}if(t===`
`){e.push(n),i.push(e),e=[],n="";continue}if(t==="\r"){r===`
`&&(s+=1),e.push(n),i.push(e),e=[],n="";continue}n+=t}return e.push(n),i.push(e),i.filter(s=>s.some(t=>t.trim().length))}function p(o){if(!o)return[];const i=o.length>0&&o.charCodeAt(0)===65279?o.slice(1):o,e=g(i);if(!e.length)return[];const[n,...a]=e,s=n.map(t=>t.trim());return a.map(t=>{const r={};return s.forEach((f,c)=>{r[f]=t[c]??""}),r})}function w(o){const e=String(o??"").normalize("NFKC").match(/(\d{4})/);return e?e[1]:""}let l=[];self.onmessage=async o=>{const{type:i,payload:e,id:n}=o.data;if(i==="init")try{const a=await fetch(e.path);if(!a.ok)throw new Error(`HTTP ${a.status}`);const s=await a.text();l=p(s),l=p(s);const t=Array.from(new Set(l.map(r=>w(r.導入月)).filter(r=>/^\d{4}$/.test(r)))).sort((r,f)=>Number(f)-Number(r));self.postMessage({type:"init-complete",years:t})}catch(a){self.postMessage({type:"error",error:a.message})}else if(i==="search"){if(!l.length){self.postMessage({type:"search-result",digits:null,recentHits:[],id:n});return}const{keyword:a,andCond:s}=e,t=(a??"").normalize("NFKC").toLowerCase(),r=[];for(const c of l){const C=Object.values(c),y=t?C.some(d=>d?.normalize("NFKC").toLowerCase().includes(t)):!0;let u=!0;const h=s?.field||"none",m=(s?.value??"").normalize("NFKC").toLowerCase();if(h==="name")u=(c.機種名??"").normalize("NFKC").toLowerCase().includes(m);else if(h==="maker")u=(c.メーカー??"").normalize("NFKC").toLowerCase().includes(m);else if(h==="year"){const d=w(c.導入月);u=!!m&&d===m}y&&u&&r.push({name:c.機種名,maker:c.メーカー})}const f=String(r.length).padStart(4,"0").split("");self.postMessage({type:"search-result",digits:f,recentHits:r,id:n})}}})();
